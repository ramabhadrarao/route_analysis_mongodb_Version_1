<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DataCollectionService.js - APIs Actually Used</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        
        .header {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .api-card {
            background: white;
            margin: 20px 0;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 5px solid #007bff;
        }
        
        .api-used {
            border-left-color: #28a745;
        }
        
        .api-mock {
            border-left-color: #ffc107;
            background-color: #fff9e6;
        }
        
        .code-block {
            background-color: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            overflow-x: auto;
            border: 1px solid #4a5568;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 10px;
        }
        
        .status-active {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-mock {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .function-name {
            background-color: #e3f2fd;
            color: #1565c0;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9em;
        }
        
        .api-endpoint {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            margin: 10px 0;
            font-size: 13px;
        }
        
        .warning-box {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
            border-left: 4px solid #f39c12;
        }
        
        .method-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .method-table th, .method-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .method-table th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-weight: 600;
        }
        
        .method-table tr:hover {
            background-color: #f8f9fa;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üîç DataCollectionService.js</h1>
        <h2>APIs Actually Used Analysis</h2>
        <p>Detailed breakdown of which APIs are really called vs mocked</p>
    </div>

    <div class="api-card api-used">
        <div class="status-badge status-active">ACTIVELY USED</div>
        <h2>üó∫Ô∏è Google Places API</h2>
        <p><strong>Primary API used throughout the service</strong></p>
        
        <h3>Functions that call this API:</h3>
        <ul>
            <li><span class="function-name">apiService.findNearbyPlaces()</span></li>
            <li><span class="function-name">collectDetailedEmergencyServices()</span></li>
            <li><span class="function-name">collectLawEnforcementServices()</span></li>
            <li><span class="function-name">collectFireRescueServices()</span></li>
            <li><span class="function-name">collectFuelStations()</span></li>
            <li><span class="function-name">collectEducationalInstitutions()</span></li>
            <li><span class="function-name">collectFoodRestStops()</span></li>
            <li><span class="function-name">collectFinancialServices()</span></li>
            <li><span class="function-name">collectTransportationHubs()</span></li>
        </ul>

        <h3>API Endpoint Used:</h3>
        <div class="api-endpoint">
            https://maps.googleapis.com/maps/api/place/nearbysearch/json<br>
            ?location={latitude},{longitude}<br>
            &radius={radius}<br>
            &type={service_type}<br>
            &key={GOOGLE_MAPS_API_KEY}
        </div>

        <h3>Code Implementation:</h3>
        <div class="code-block">
const nearbyServices = await apiService.findNearbyPlaces(
  segment.latitude,
  segment.longitude,
  serviceKey,
  config.radius
);

// Example service types searched:
// 'hospital', 'police', 'fire_station', 'gas_station', 
// 'restaurant', 'bank', 'atm', 'school', 'university'
        </div>
    </div>

    <div class="api-card api-used">
        <div class="status-badge status-active">ACTIVELY USED</div>
        <h2>üå§Ô∏è OpenWeatherMap API</h2>
        <p><strong>Used for current weather data collection</strong></p>
        
        <h3>Functions that call this API:</h3>
        <ul>
            <li><span class="function-name">apiService.getWeatherData()</span></li>
            <li><span class="function-name">collectEnhancedWeatherData()</span></li>
        </ul>

        <h3>API Endpoint Used:</h3>
        <div class="api-endpoint">
            https://api.openweathermap.org/data/2.5/weather<br>
            ?lat={latitude}<br>
            &lon={longitude}<br>
            &appid={OPENWEATHER_API_KEY}<br>
            &units=metric
        </div>

        <h3>Code Implementation:</h3>
        <div class="code-block">
const currentWeather = await apiService.getWeatherData(
  segment.latitude, 
  segment.longitude
);

// Data collected:
// - temperature, humidity, pressure
// - windSpeed, windDirection, visibility
// - weather condition, description
        </div>
    </div>

    <div class="api-card api-used">
        <div class="status-badge status-active">ACTIVELY USED</div>
        <h2>üöó TomTom Traffic API</h2>
        <p><strong>Used for real-time traffic data (with fallback)</strong></p>
        
        <h3>Functions that call this API:</h3>
        <ul>
            <li><span class="function-name">apiService.getTrafficData()</span></li>
            <li><span class="function-name">collectDetailedTrafficData()</span></li>
        </ul>

        <h3>API Endpoint Used:</h3>
        <div class="api-endpoint">
            https://api.tomtom.com/traffic/services/4/flowSegmentData/absolute/10/json<br>
            ?point={latitude},{longitude}<br>
            &unit=KMPH<br>
            &key={TOMTOM_API_KEY}
        </div>

        <h3>Code Implementation:</h3>
        <div class="code-block">
const trafficData = await apiService.getTrafficData(
  segment.latitude, 
  segment.longitude
);

// Returns: currentSpeed, freeFlowSpeed, confidence, roadClosure
// Has fallback values if API fails
        </div>
    </div>

    <div class="api-card api-mock">
        <div class="status-badge status-mock">MOCK IMPLEMENTATION</div>
        <h2>üìç Google Places Details API</h2>
        <p><strong>Called but returns mock data</strong></p>
        
        <h3>Function that attempts to call this:</h3>
        <ul>
            <li><span class="function-name">getPlaceDetails(placeId)</span></li>
        </ul>

        <div class="warning-box">
            <strong>‚ö†Ô∏è Mock Implementation:</strong> This function is called throughout the service but currently returns hardcoded mock data instead of making real API calls.
        </div>

        <h3>Mock Implementation:</h3>
        <div class="code-block">
async getPlaceDetails(placeId) {
  try {
    // Mock implementation - would use Google Places Details API
    return {
      phoneNumber: '+91-' + Math.floor(Math.random() * 10000000000),
      address: 'Address not available',
      operatingHours: 'Hours not available',
      website: '',
      accessibility: 'Unknown',
      amenities: []
    };
  } catch (error) {
    return {
      phoneNumber: 'Not available',
      address: 'Address not available',
      operatingHours: 'Hours not available'
    };
  }
}
        </div>
    </div>

    <div class="api-card api-mock">
        <div class="status-badge status-mock">MOCK IMPLEMENTATION</div>
        <h2>üìä Historical Weather Data</h2>
        <p><strong>Visual Crossing API - Mock implementation</strong></p>
        
        <h3>Function that returns mock data:</h3>
        <ul>
            <li><span class="function-name">getHistoricalWeatherPatterns()</span></li>
        </ul>

        <h3>Mock Implementation:</h3>
        <div class="code-block">
async getHistoricalWeatherPatterns(latitude, longitude) {
  try {
    // Mock historical weather data - would integrate with weather APIs
    return {
      averagePrecipitation: Math.random() * 100,
      averageUvIndex: Math.random() * 10,
      extremeEvents: ['Heavy Rain (2023)', 'Hailstorm (2022)']
    };
  } catch (error) {
    return {
      averagePrecipitation: 50,
      averageUvIndex: 5,
      extremeEvents: []
    };
  }
}
        </div>
    </div>

    <div class="api-card">
        <h2>üìã Complete API Usage Summary</h2>
        
        <table class="method-table">
            <thead>
                <tr>
                    <th>Collection Method</th>
                    <th>Primary API Used</th>
                    <th>Status</th>
                    <th>Data Points Collected</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Emergency Services</td>
                    <td>Google Places API</td>
                    <td>‚úÖ Active</td>
                    <td>Hospitals, Police, Fire Stations</td>
                </tr>
                <tr>
                    <td>Fuel Stations</td>
                    <td>Google Places API</td>
                    <td>‚úÖ Active</td>
                    <td>Gas Stations, Repair Shops</td>
                </tr>
                <tr>
                    <td>Food & Rest</td>
                    <td>Google Places API</td>
                    <td>‚úÖ Active</td>
                    <td>Restaurants, Hotels, Cafes</td>
                </tr>
                <tr>
                    <td>Weather Data</td>
                    <td>OpenWeatherMap API</td>
                    <td>‚úÖ Active</td>
                    <td>Current Weather Conditions</td>
                </tr>
                <tr>
                    <td>Traffic Data</td>
                    <td>TomTom Traffic API</td>
                    <td>‚ö†Ô∏è With Fallback</td>
                    <td>Speed, Congestion, Flow</td>
                </tr>
                <tr>
                    <td>Educational Institutions</td>
                    <td>Google Places API</td>
                    <td>‚úÖ Active</td>
                    <td>Schools, Universities, Colleges</td>
                </tr>
                <tr>
                    <td>Financial Services</td>
                    <td>Google Places API</td>
                    <td>‚úÖ Active</td>
                    <td>Banks, ATMs, Post Offices</td>
                </tr>
                <tr>
                    <td>Transportation Hubs</td>
                    <td>Google Places API</td>
                    <td>‚úÖ Active</td>
                    <td>Bus Stations, Train Stations</td>
                </tr>
                <tr>
                    <td>Place Details</td>
                    <td>Google Places Details API</td>
                    <td>‚ùå Mock Only</td>
                    <td>Phone Numbers, Hours, Addresses</td>
                </tr>
                <tr>
                    <td>Historical Weather</td>
                    <td>Visual Crossing API</td>
                    <td>‚ùå Mock Only</td>
                    <td>Historical Patterns, Trends</td>
                </tr>
                <tr>
                    <td>Road Conditions</td>
                    <td>No External API</td>
                    <td>üìä Algorithmic</td>
                    <td>Calculated from Route Data</td>
                </tr>
                <tr>
                    <td>Accident Areas</td>
                    <td>No External API</td>
                    <td>üìä Algorithmic</td>
                    <td>Risk Factor Analysis</td>
                </tr>
                <tr>
                    <td>Network Coverage</td>
                    <td>No External API</td>
                    <td>üìä Algorithmic</td>
                    <td>Terrain-Based Estimation</td>
                </tr>
                <tr>
                    <td>Security Analysis</td>
                    <td>No External API</td>
                    <td>üìä Algorithmic</td>
                    <td>Route Characteristic Analysis</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="warning-box">
        <h3>üéØ Key Insights:</h3>
        <ul>
            <li><strong>Google Places API</strong> is the workhorse - used for 80% of data collection</li>
            <li><strong>OpenWeatherMap API</strong> provides all weather data</li>
            <li><strong>TomTom Traffic API</strong> is used but has fallback mechanisms</li>
            <li><strong>Many analyses are algorithmic</strong> - calculated from route characteristics rather than external APIs</li>
            <li><strong>Place Details API is mocked</strong> - detailed information like phone numbers and hours are generated</li>
        </ul>
    </div>

    <div class="api-card">
        <h2>üîß API Rate Limiting Strategy</h2>
        <p>The service implements rate limiting through:</p>
        <div class="code-block">
// Sequential processing with delays
for (const segment of routeSegments) {
  // Process each segment
  await new Promise(resolve => setTimeout(resolve, 100)); // 100ms delay
}

// Limited results per query
for (const service of nearbyServices.slice(0, 5)) { // Top 5 per segment
  // Process service
}
        </div>
    </div>
</body>
</html>